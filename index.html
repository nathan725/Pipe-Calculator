<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipe Bedding + Cover Calculator & Project Manager</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; background: #f1f5f9; }
        .split { display: flex; height: 100vh; }
        .sidebar { width: 320px; background: #2c3e50; color: white; overflow-y: auto; padding: 15px; }
        .main { flex: 1; padding: 20px; background: #fff; overflow-y: auto; }
        h1 { color: #ecf0f1; margin-top: 0; }
        h2 { color: #bdc3c7; margin-bottom: 10px; }
        input, button { width: 100%; padding: 10px; margin: 5px 0; border-radius: 6px; border: none; box-sizing: border-box; }
        input { background: #34495e; color: white; }
        input::placeholder { color: #95a5a6; }
        button { background: #3498db; color: white; cursor: pointer; font-weight: bold; }
        button:hover { background: #2980b9; }
        .tree-item { padding: 8px; cursor: pointer; border-bottom: 1px solid #34495e; position: relative; }
        .project { background: #34495e; font-weight: bold; }
        .job { padding-left: 30px; background: #3d566e; }
        .tree-item:hover { background: #4a6785; }
        .active { background: #e67e22 !important; }
        .add-btn { background: #27ae60; font-size: 12px; width: auto; padding: 5px 10px; margin-left: 10px; }
        .container { display: flex; flex-wrap: wrap; gap: 20px; }
        .inputs { flex: 1; min-width: 300px; }
        .diagram { flex: 1; min-width: 350px; background: #f8f9fa; padding: 20px; border-radius: 8px; }
        label { display: block; margin: 10px 0 5px; font-weight: bold; color: #333; }
        .results { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .card { padding: 15px; border-radius: 8px; text-align: center; color: white; font-size: 16px; }
        .bed { background: #e67e22; }
        .cov { background: #2980b9; }
        .tot { background: #27ae60; grid-column: span 2; }
        svg { width: 100%; height: 400px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="split">
        <div class="sidebar">
            <h1>Pipe Calculator Pro</h1>
            <input type="text" id="newProjectName" placeholder="New Project (e.g., Walmart-Tucson)">
            <button onclick="addProject()">+ Add Project</button>
            <hr style="border-color: #34495e;">
            <h2>Projects</h2>
            <div id="projectTree"></div>
        </div>
        <div class="main">
            <div class="container">
                <div class="inputs">
                    <h2>Job Details</h2>
                    <label>Pipe Diameter (inches)</label>
                    <input type="number" id="diameter" value="10.35" step="0.01">
                    <label>Trench Width (ft)</label>
                    <input type="number" id="width" value="3" step="0.1">
                    <label>Bedding Below Invert (ft)</label>
                    <input type="number" id="beddingBelow" value="0.5" step="0.05">
                    <label>Cover Above Crown (ft)</label>
                    <input type="number" id="coverAbove" value="0.5" step="0.1">
                    <label>Length (ft)</label>
                    <input type="number" id="length" value="89" step="1">
                    <label>Tons per CY</label>
                    <input type="number" id="tonsPerCY" value="1.8" step="0.05">
                    <button onclick="saveCurrentJob()">Save This Job</button>
                </div>
                <div class="diagram">
                    <h3>Live Cross-Section</h3>
                    <svg id="diagramSvg" viewBox="0 0 400 400"></svg>
                </div>
            </div>
            <div class="results" id="results"></div>
        </div>
    </div>

    <script>
        let projects = JSON.parse(localStorage.getItem('pipeProjects')) || {};
        let currentProject = null;
        let currentJob = null;

        function renderTree() {
            const tree = document.getElementById('projectTree');
            tree.innerHTML = '';
            Object.keys(projects).forEach(projectName => {
                const projectDiv = document.createElement('div');
                projectDiv.className = 'tree-item project' + (currentProject === projectName ? ' active' : '');
                projectDiv.textContent = projectName;
                projectDiv.onclick = () => loadProject(projectName);
                tree.appendChild(projectDiv);

                Object.keys(projects[projectName]).forEach(jobName => {
                    const jobDiv = document.createElement('div');
                    jobDiv.className = 'tree-item job' + (currentProject === projectName && currentJob === jobName ? ' active' : '');
                    jobDiv.textContent = `  â”” ${jobName}`;
                    jobDiv.onclick = () => loadJob(projectName, jobName);
                    tree.appendChild(jobDiv);
                });

                const addJobBtn = document.createElement('button');
                addJobBtn.className = 'add-btn';
                addJobBtn.textContent = '+ Job';
                addJobBtn.onclick = () => {
                    const name = prompt('Job Name (e.g., 8" Sanitary Sewer):');
                    if (name && currentProject === projectName) addJob(name);
                };
                projectDiv.appendChild(addJobBtn);
            });
        }

        function addProject() {
            const name = document.getElementById('newProjectName').value.trim();
            if (name) {
                if (!projects[name]) projects[name] = {};
                currentProject = name;
                saveProjects();
                renderTree();
                document.getElementById('newProjectName').value = '';
            }
        }

        function addJob(name) {
            if (currentProject && name) {
                projects[currentProject][name] = { diameter: 10.35, width: 3, beddingBelow: 0.5, coverAbove: 0.5, length: 89, tonsPerCY: 1.8 };
                saveProjects();
                renderTree();
                loadJob(currentProject, name);
            }
        }

        function loadProject(name) {
            currentProject = name;
            currentJob = null;
            renderTree();
        }

        function loadJob(project, job) {
            currentProject = project;
            currentJob = job;
            const data = projects[project][job];
            document.getElementById('diameter').value = data.diameter;
            document.getElementById('width').value = data.width;
            document.getElementById('beddingBelow').value = data.beddingBelow;
            document.getElementById('coverAbove').value = data.coverAbove;
            document.getElementById('length').value = data.length;
            document.getElementById('tonsPerCY').value = data.tonsPerCY;
            calculate();
            renderTree();
        }

        function saveCurrentJob() {
            if (currentProject && currentJob) {
                const data = {
                    diameter: parseFloat(document.getElementById('diameter').value),
                    width: parseFloat(document.getElementById('width').value),
                    beddingBelow: parseFloat(document.getElementById('beddingBelow').value),
                    coverAbove: parseFloat(document.getElementById('coverAbove').value),
                    length: parseFloat(document.getElementById('length').value),
                    tonsPerCY: parseFloat(document.getElementById('tonsPerCY').value)
                };
                projects[currentProject][currentJob] = data;
                saveProjects();
                alert('Job saved!');
            } else {
                alert('Select or create a project/job first!');
            }
        }

        function saveProjects() {
            localStorage.setItem('pipeProjects', JSON.stringify(projects));
        }

        function calculate() {
            const dIn = parseFloat(document.getElementById('diameter').value) || 0;
            const wFt = parseFloat(document.getElementById('width').value) || 0;
            const bedBl = parseFloat(document.getElementById('beddingBelow').value) || 0;
            const covAb = parseFloat(document.getElementById('coverAbove').value) || 0;
            const len = parseFloat(document.getElementById('length').value) || 0;
            const tCY = parseFloat(document.getElementById('tonsPerCY').value) || 1.8;

            const dFt = dIn / 12;
            const rFt = dFt / 2;
            const pipeArea = Math.PI * rFt ** 2;

            const bedRectH = bedBl + rFt;
            const covRectH = rFt + covAb;
            const bedRectA = wFt * bedRectH;
            const covRectA = wFt * covRectH;

            const bedCY = (bedRectA * len / 27) - (pipeArea * len / 2 / 27);
            const covCY = (covRectA * len / 27) - (pipeArea * len / 2 / 27);
            const totCY = bedCY + covCY;

            document.getElementById('results').innerHTML = `
                <div class="card bed"><b>BEDDING</b><br>${bedCY.toFixed(2)} CY<br>${(bedCY * tCY).toFixed(1)} Tons</div>
                <div class="card cov"><b>COVER</b><br>${covCY.toFixed(2)} CY<br>${(covCY * tCY).toFixed(1)} Tons</div>
                <div class="card tot"><b>TOTAL</b><br>${totCY.toFixed(2)} CY<br>${(totCY * tCY).toFixed(1)} Tons</div>
            `;

            // Live Diagram
            const svg = document.getElementById('diagramSvg');
            svg.innerHTML = '';
            const scale = 80;
            const cx = 200;
            const yBot = 350;
            const totH = bedBl + dFt + covAb;

            // Trench
            svg.innerHTML += `<rect x="${cx - wFt * scale / 2}" y="${yBot - totH * scale}" width="${wFt * scale}" height="${totH * scale}" fill="none" stroke="#333" stroke-width="2"/>`;

            // Bedding
            svg.innerHTML += `<rect x="${cx - wFt * scale / 2}" y="${yBot - bedRectH * scale}" width="${wFt * scale}" height="${bedRectH * scale}" fill="#e67e22" opacity="0.6"/>`;

            // Cover
            svg.innerHTML += `<rect x="${cx - wFt * scale / 2}" y="${yBot - (bedRectH + covAb) * scale}" width="${wFt * scale}" height="${covRectH * scale}" fill="#3498db" opacity="0.6"/>`;

            // Pipe
            const pipeY = yBot - bedBl * scale - rFt * scale;
            svg.innerHTML += `<circle cx="${cx}" cy="${pipeY}" r="${rFt * scale}" fill="#2c3e50"/>`;

            // Labels
            svg.innerHTML += `<text x="${cx}" y="${pipeY + 5}" text-anchor="middle" fill="white" font-size="12">${dIn.toFixed(1)}"</text>`;
        }

        // Event listeners
        document.querySelectorAll('input').forEach(input => input.addEventListener('input', calculate));
        renderTree();
        calculate();
    </script>
</body>
</html>
